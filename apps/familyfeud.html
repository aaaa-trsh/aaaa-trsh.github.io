<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>keith b's funhouse</title>
    <!-- <link href="./assets/IBM_Plex_Mono.css" rel="stylesheet"> -->
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <style>
        body {
            background-image: url("../assets/imgs/ffbg.jpg");
            color: #fff;
            font-size: 30px;
        }
        
        .response-space {
            /* padding: 5px; */
            border: 3px white ridge;
            text-align: center;
            padding: 3px;
            background: linear-gradient(rgb(3, 3, 78), rgb(19, 19, 190), black);
            position: relative;
            width: 50%;
            display: table-cell;
        }
        
        .flip {
            animation: flip 0.5s cubic-bezier(0, 1.15, .6, .97);
        }
        
        .response-freq {
            float: right;
            padding: 3px 10px;
            border: 2px rgb(117, 135, 225) ridge;
            background: linear-gradient(rgb(125, 125, 239), rgb(19, 19, 190));
            width: .8em;
        }
        
        .response-tab {
            line-height: 1.3;
        }
        
        .response-cover {
            background: radial-gradient(farthest-corner at 50% 20%, cyan 0%, rgb(117, 123, 225) 50%, rgb(41, 58, 188) 80%, rgb(8, 34, 108) 90%);
            z-index: 100;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #frame {
            background-color: black;
            padding: 10px;
            border: 6px ridge white;
            border-radius: 10px;
            width: 40%;
            margin: auto;
            margin-top: 10%;
            table-layout: fixed;
        }
        
        table {
            table-layout: fixed;
            width: 100%;
        }
        
        #frame h3 {
            width: 3em;
            margin: 0 auto;
            width: fit-content;
            padding: 5px 10px;
            margin-bottom: 10px;
            border: 3px ridge white;
            text-align: center;
            background-color: blue;
        }
        
        @keyframes flip {
            0% {
                transform: scaleY(1);
            }
            50% {
                transform: scaleY(0);
            }
            100% {
                transform: scaleY(1);
            }
        }
    </style>
</head>

<body oncontextmenu="return false">
    <div id="frame">
        <h3 id="scoreCounter">SCORE</h3>
        <table>
            <tr>
                <td class="response-space" l="0" onclick="flip(this, 0)"><span class="response-cover"></span></td>
                <td class="response-space" l="1" onclick="flip(this, 1)"><span class="response-cover"></span></td>
            </tr>
            <tr>
                <td class="response-space" l="2" onclick="flip(this, 2)"><span class="response-cover"></span></td>
                <td class="response-space" l="3" onclick="flip(this, 3)"><span class="response-cover"></span></td>
            </tr>
            <tr>
                <td class="response-space" l="4" onclick="flip(this, 4)"><span class="response-cover"></span></td>
                <td class="response-space" l="5" onclick="flip(this, 5)"><span class="response-cover"></span></td>
            </tr>
            <tr>
                <td class="response-space" l="6" onclick="flip(this, 6)"><span class="response-cover"></span></td>
                <td class="response-space" l="7" onclick="flip(this, 7)"><span class="response-cover"></span></td>
            </tr>
        </table>
    </div>
    <script type="text/javascript">
        let raw = `Timestamp,Test 1,Ae,
5/25/2022 9:57:35,test,Aw,
5/25/2022 9:57:35,test,Aw,
5/25/2022 9:57:35,testa,Ae,
5/25/2022 9:57:35,testb,Ae,
5/25/2022 9:57:35,testb,Ae,
5/25/2022 9:57:35,testc,Ae,
5/25/2022 9:57:35,testc,Ae,
5/25/2022 9:57:35,test1,Ae,
5/25/2022 9:57:35,test2,Ae,
5/25/2022 9:57:35,test3,Ae,
5/25/2022 9:57:35,test4,Ae,
5/25/2022 9:57:35,test5,Ae,
5/25/2022 9:57:35,test5,Ae,
5/25/2022 9:57:35,test5,abc,
5/25/2022 9:57:35,test5,abc,
5/25/2022 9:57:35,test6,abc,
5/25/2022 9:57:35,test7,abc,
5/25/2022 9:57:35,test8,abc,
5/25/2022 9:57:35,test9,1,
5/25/2022 9:57:35,test10,2,
5/25/2022 9:57:35,testc,3`

        Object.defineProperties(Array.prototype, {
            count: {
                value: function(value) {
                    return this.filter(x => x == value).length;
                }
            }
        });
        let qid = 0;
        let scoreCounter = document.getElementById("scoreCounter");
        let rows = raw.split("\n").map(x => x.split(","));
        let data = rows[0].map((col, i) => rows.map(row => row[i])).splice(1);
        let questions = data.map(x => x[0]);
        let responses = data.map(x => x.slice(1));
        let uResponses = responses.map(x => [...new Set(x)]);
        let rQuantities = uResponses.map((x, i) => x.map(y => responses[i].count(y)));
        let grouped = rQuantities.map((x, i) => x.map((y, j) => [y, uResponses[i][j]]));
        grouped = grouped.map(x => x.sort((a, b) => b[0] - a[0]))
        let responseElements = [...document.querySelectorAll(".response-space")];
        responseElements.forEach((x, i) => {
            x.innerHTML += "<span class='response-tab'>" + grouped[qid][i][1] + `<span class="response-freq">${grouped[qid][i][0]}</span > `;
        });
        let score = 0;

        function flip(x, i) {
            x.classList.add("flip");
            score += grouped[qid][i][0];
            scoreCounter.innerHTML = score;
            setTimeout(() => x.firstChild.style.display = "none", 250);
        }
    </script>
</body>

</html>